

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div class="section color-{{ section.settings.color_scheme }}">
  <div
    class="
      spacing-style
      layout-panel-flex
      layout-panel-flex--column
      section-content-wrapper
      mobile-column
    "
    style="
      {% render 'layout-panel-style', settings: section.settings %}
      {% render 'spacing-style', settings: section.settings %}
    "
  >
    <header>
      {%- content_for 'block', id: 'blog-post-title', type: 'text' %}
      {%- content_for 'block', id: 'blog-post-details', type: '_blog-post-info-text' %}
    </header>

    {%- if article.image -%}
      {%- content_for 'block', id: 'blog-post-image', type: '_blog-post-featured-image', image: article.image %}
    {%- endif -%}
    {%- content_for 'block', id: 'blog-post-content', type: '_blog-post-content' %}

<!-- ============================= -->
<!-- Bideshi Custom Multimedia Layer -->
<!-- ============================= -->

<style>
  .article-media {
    margin: 2.5rem 0;
    display: grid;
    gap: 1.75rem;
  }
  .article-media img,
  .article-media video,
  .article-media iframe {
    width: 100%;
    max-width: 100%;
    border-radius: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .article-media audio {
    width: 100%;
    margin-top: 0.5rem;
  }
  .article-media iframe {
    aspect-ratio: 16 / 9;
  }
  .article-media figcaption {
    font-size: 0.875rem;
    color: rgba(0,0,0,0.6);
    margin-top: 0.4rem;
    text-align: center;
  }
</style>

<div class="article-media">

  <!-- Images -->
  {% assign media_images = article.metafields.custom.media_image.value %}
  {% if media_images %}
    {% for image in media_images %}
      <figure>
        <img
          src="{{ image | image_url: width: 1200 }}"
          alt="{{ article.title }}"
          loading="lazy"
        >
      </figure>
    {% endfor %}
  {% endif %}

  <!-- Audio -->
  {% assign media_audios = article.metafields.custom.media_audio.value %}
  {% if media_audios %}
    {% for audio in media_audios %}
      <figure>
        <audio controls preload="none">
          <source src="{{ audio.url }}" type="{{ audio.mime_type | default: 'audio/mpeg' }}">
          Your browser does not support the audio element.
        </audio>
      </figure>
    {% endfor %}
  {% endif %}

  <!-- Uploaded Video Files -->
  {% assign media_videos = article.metafields.custom.media_video.value %}
  {% if media_videos %}
    {% for video in media_videos %}
      <figure>
        {{ video | video_tag: controls: true, preload: "metadata" }}
      </figure>
    {% endfor %}
  {% endif %}

  <!-- External Video Links (YouTube/Vimeo) -->
  {% assign media_video_links = article.metafields.custom.media_video_link.value %}
  {% if media_video_links %}
    {% for link in media_video_links %}
      {% assign embed_link = link
        | replace: "watch?v=", "embed/"
        | replace: "youtu.be/", "youtube.com/embed/"
        | replace: "&list", "?list"
      %}
      <figure>
        <iframe
          src="{{ embed_link | escape }}"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </figure>
    {% endfor %}
  {% endif %}

</div>

<!-- ============================= -->
<!-- End Bideshi Custom Multimedia Layer -->
<!-- ============================= -->


<!--Debugging-->
<div style="border:2px dashed #06f; padding:12px; margin:1.5rem 0; background:#f0f8ff;">
  <strong>DEBUG: Multimedia Metafield Values</strong><br>

  <p><b>Audio metafield (raw):</b><br>
  {{ article.metafields.custom.media_audio | default: "⚠️ No metafield found" }}</p>

  <p><b>Audio metafield (.value):</b><br>
  {{ article.metafields.custom.media_audio.value | default: "⚠️ No .value" }}</p>

  <p><b>Video metafield (raw):</b><br>
  {{ article.metafields.custom.media_video | default: "⚠️ No metafield found" }}</p>

  <p><b>Video metafield (.value):</b><br>
  {{ article.metafields.custom.media_video.value | default: "⚠️ No .value" }}</p>

  <p><b>Video link metafield (raw):</b><br>
  {{ article.metafields.custom.media_video_link | default: "⚠️ No metafield found" }}</p>

  <p><b>Video link metafield (.value):</b><br>
  {{ article.metafields.custom.media_video_link.value | default: "⚠️ No .value" }}</p>
</div>

<!--Debugging End-->
    
    {% if blog.comments_enabled? %}
      <div class="blog-post-comments-container">
        <h2 class="h3">{{- 'blogs.article.comments_heading' | t: count: article.comments_count -}}</h2>

        <div class="blog-post-comments">
          {% paginate article.comments by 10 %}
            {% for comment in article.comments %}
              <div class="blog-post-comment">
                {{ comment.content }}
                <div class="blog-post-comment__author">
                  <span class="blog-post-comment__author-name">{{- comment.author -}}</span>
                  <span>{{- 'blogs.article.comment_author_separator' | t -}}</span>
                  <span class="blog-post-comment__date">
                    {{- comment.created_at | time_tag: format: 'date' -}}
                  </span>
                </div>
              </div>
            {% endfor %}

            <div class="blog-post-comments-pagination">
              {{- paginate | default_pagination -}}
            </div>
          {% endpaginate %}
        </div>

        {% render 'blog-comment-form', article: article, section_id: section.id %}
      </div>
    {% endif %}
  </div>
</div>

<script type="application/ld+json">
  {{ article | structured_data }}
</script>

{% stylesheet %}
  .blog-post-comments-container {
    width: 100%;
    max-width: var(--normal-content-width);
    margin: 0 auto;
  }

  .blog-post-comments {
    display: flex;
    flex-direction: column;
    gap: var(--gap-3xl);
  }

  .blog-post-comment__author {
    display: flex;
    align-items: center;
    gap: var(--gap-2xs);
    margin-top: var(--margin-md);
    font-size: var(--font-size--body-sm);
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text));
  }

  .blog-post-comments-pagination {
    display: flex;
    justify-content: center;
    gap: var(--gap-2xs);
  }

  .blog-post-comments-pagination,
  .blog-post-comments-pagination a {
    color: var(--color-foreground);
  }

  .blog-post-comments-pagination .current {
    color: var(--color-foreground);
  }

  .blog-post-comments-pagination .current,
  .blog-post-comments-pagination a {
    display: block;
    padding: var(--padding-2xs) var(--padding-xs);
  }

  .blog-post-comments-pagination .current,
  .blog-post-comments-pagination a:hover {
    border-bottom: 1px solid var(--color-foreground);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.blog_post",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "select",
      "id": "content_direction",
      "label": "t:settings.direction",
      "options": [
        {
          "value": "column",
          "label": "t:options.vertical"
        }
      ],
      "default": "column",
      "visible_if": "{{ section.settings.gap < 0 }}"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": []
}
{% endschema %}
